[gd_scene load_steps=18 format=3 uid="uid://vuw0uo7ee6f1"]

[ext_resource type="Script" uid="uid://nlf48em5vx7s" path="res://scripts/Player.cs" id="1_q2a4a"]
[ext_resource type="Script" uid="uid://cxvumuypfbiq0" path="res://scripts/WorldCamera.cs" id="2_bpemp"]
[ext_resource type="Script" uid="uid://bxpx6big8awju" path="res://scripts/weapon/WeaponManager.cs" id="2_wcynd"]
[ext_resource type="PackedScene" uid="uid://ca0n4ipvo7ibi" path="res://scenes/weapons/revolver.tscn" id="3_4w23u"]
[ext_resource type="AudioStream" uid="uid://50dsygx5pvso" path="res://assets/sounds/outofammo.wav" id="3_hn2ns"]
[ext_resource type="PackedScene" uid="uid://djs7lqr7y5i0p" path="res://scenes/weapons/rifle.tscn" id="4_5d350"]
[ext_resource type="PackedScene" uid="uid://6tdaegilclrw" path="res://scenes/weapons/shotgun.tscn" id="6_bkpjo"]
[ext_resource type="Script" uid="uid://l2os50dy02yn" path="res://scripts/components/HurtboxComponent.cs" id="6_dsggb"]
[ext_resource type="Script" uid="uid://l3652hha04fo" path="res://scripts/components/HealthComponent.cs" id="7_d8ysm"]
[ext_resource type="PackedScene" uid="uid://bggj4efpnq4de" path="res://scenes/ui/ammo_counter.tscn" id="11_4lqii"]

[sub_resource type="CylinderShape3D" id="CylinderShape3D_nir0a"]
height = 1.8
radius = 0.3

[sub_resource type="CylinderShape3D" id="CylinderShape3D_ci7k8"]
height = 1.8

[sub_resource type="Gradient" id="Gradient_cqy40"]
interpolation_mode = 1
offsets = PackedFloat32Array(0.0194805, 0.564935)
colors = PackedColorArray(1, 1, 1, 1, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_hqi3n"]
gradient = SubResource("Gradient_cqy40")
width = 8
height = 8
fill = 1
fill_from = Vector2(0.5, 0.5)
metadata/_snap_enabled = true

[sub_resource type="LabelSettings" id="LabelSettings_v04c8"]
font_size = 24

[sub_resource type="GDScript" id="GDScript_nidvv"]
script/source = "extends Label

func update_health_label(_healthChange: int, health: int):
	text = \"HP: \" + str(health)
"

[sub_resource type="CapsuleMesh" id="CapsuleMesh_0wh4b"]
radius = 0.4
height = 1.8

[node name="Player" type="CharacterBody3D" node_paths=PackedStringArray("Head", "Arms", "Health")]
collision_layer = 3
script = ExtResource("1_q2a4a")
Speed = 10.0
Head = NodePath("Head")
Arms = NodePath("Head/CanvasLayer/SubViewportContainer/SubViewport/WeaponCamera/Arms")
Health = NodePath("HealthComponent")
CameraAngleMax = 1.48353
CameraAngleMin = -1.48353
ArmsSwayAmount = 0.001

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.9, 0)
shape = SubResource("CylinderShape3D_nir0a")

[node name="Head" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.6, 0)

[node name="AttackRay" type="RayCast3D" parent="Head"]
target_position = Vector3(0, 0, -1000)
collision_mask = 5
collide_with_areas = true
collide_with_bodies = false

[node name="WorldCamera" type="Camera3D" parent="Head" node_paths=PackedStringArray("weaponCamera")]
cull_mask = 1048573
fov = 90.0
script = ExtResource("2_bpemp")
weaponCamera = NodePath("../CanvasLayer/SubViewportContainer/SubViewport/WeaponCamera")

[node name="CanvasLayer" type="CanvasLayer" parent="Head"]

[node name="SubViewportContainer" type="SubViewportContainer" parent="Head/CanvasLayer"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="SubViewport" type="SubViewport" parent="Head/CanvasLayer/SubViewportContainer"]
transparent_bg = true
handle_input_locally = false
size = Vector2i(1152, 648)
render_target_update_mode = 4

[node name="WeaponCamera" type="Camera3D" parent="Head/CanvasLayer/SubViewportContainer/SubViewport"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.6, 0)
cull_mask = 1047554
fov = 60.0

[node name="Arms" type="Node3D" parent="Head/CanvasLayer/SubViewportContainer/SubViewport/WeaponCamera"]

[node name="Revolver" parent="Head/CanvasLayer/SubViewportContainer/SubViewport/WeaponCamera/Arms" instance=ExtResource("3_4w23u")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.321599, -0.3189, -0.497323)

[node name="Rifle" parent="Head/CanvasLayer/SubViewportContainer/SubViewport/WeaponCamera/Arms" instance=ExtResource("4_5d350")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.329113, -0.189163, -0.694105)
visible = false

[node name="Shotgun" parent="Head/CanvasLayer/SubViewportContainer/SubViewport/WeaponCamera/Arms" instance=ExtResource("6_bkpjo")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.316892, -0.194404, -0.69724)
visible = false

[node name="WeaponManager" type="Node3D" parent="." node_paths=PackedStringArray("WeaponHolder", "ShootRay", "WeaponAudioPlayer")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.6, 0)
script = ExtResource("2_wcynd")
WeaponHolder = NodePath("../Head/CanvasLayer/SubViewportContainer/SubViewport/WeaponCamera/Arms")
ShootRay = NodePath("../Head/AttackRay")
WeaponAudioPlayer = NodePath("WeaponAudioStreamPlayer")
OutOfAmmoAudioStream = ExtResource("3_hn2ns")

[node name="WeaponAudioStreamPlayer" type="AudioStreamPlayer" parent="WeaponManager"]
pitch_scale = 0.75
max_polyphony = 4
bus = &"Sfx"

[node name="HurtboxComponent" type="Area3D" parent="."]
collision_layer = 2
collision_mask = 4
script = ExtResource("6_dsggb")

[node name="CollisionShape3D" type="CollisionShape3D" parent="HurtboxComponent"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.9, 0)
shape = SubResource("CylinderShape3D_ci7k8")

[node name="HealthComponent" type="Node" parent="."]
script = ExtResource("7_d8ysm")

[node name="UI" type="CanvasLayer" parent="."]

[node name="Crosshair" type="TextureRect" parent="UI"]
texture_filter = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -5.0
offset_top = -5.0
offset_right = 5.0
offset_bottom = 5.0
grow_horizontal = 2
grow_vertical = 2
texture = SubResource("GradientTexture2D_hqi3n")
stretch_mode = 3

[node name="HealthLabel" type="Label" parent="UI"]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 1.0
offset_top = -73.0
offset_right = 97.0
offset_bottom = -1.0
grow_vertical = 0
text = "00 HP"
label_settings = SubResource("LabelSettings_v04c8")
horizontal_alignment = 1
vertical_alignment = 1
script = SubResource("GDScript_nidvv")

[node name="AmmoCounter" parent="UI" instance=ExtResource("11_4lqii")]

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.9, 0)
layers = 2
cast_shadow = 3
mesh = SubResource("CapsuleMesh_0wh4b")

[connection signal="AmmoUpdate" from="WeaponManager" to="UI/AmmoCounter" method="UpdateAmmoCount"]
[connection signal="HurtboxEntered" from="HurtboxComponent" to="HealthComponent" method="UpdateHealth"]
[connection signal="HealthUpdate" from="HealthComponent" to="UI/HealthLabel" method="update_health_label"]
